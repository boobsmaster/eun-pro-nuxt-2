<template>
  <section class="stages">
    <div class="stages__container">
      <header class="stages__header">
        <div class="stages__header-appendix"></div>
        <h2 class="stages__header-title">Этапы работ</h2>
      </header>
      <div class="swiper stages__slider">
        <div class="swiper-wrapper stages__slider-wrapper">
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">0.1</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">Начинаем!</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">0.2</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">С нами удобно</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">0.3</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">С нами удобно</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">0.4</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">Начинаем!</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">0.5</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">С нами удобно</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">0.6</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">С нами удобно</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">0.7</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">Начинаем!</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">0.8</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">С нами удобно</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">0.9</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">С нами удобно</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">1.0</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">С нами удобно</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge">
                <span class="stages__item-badge-text">1.1</span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">С нами удобно</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
          <div class="swiper-slide stages__slider-slide">
            <div class="stages__item">
              <div class="stages__item-badge stages__item-badge_icon">
                <img
                  class="stages__item-badge-icon"
                  src="~/assets/icons/done-white.svg"
                  alt=""
                /><span class="stages__item-badge-text"></span>
              </div>
              <div class="stages__item-info">
                <span class="stages__item-title">С нами удобно</span
                ><span class="stages__item-description"
                  >Вы можете забрать готовый отчет об оценке лично или мы
                  доставим курьером.</span
                >
              </div>
            </div>
          </div>
        </div>
        <div class="swiper-scrollbar"></div>
        <div class="slider-after slider-after_mobile"></div>
      </div>
      <div class="stages__grid stages__grid_tablet">
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.1</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">Начинаем!</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.2</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.3</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.4</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">Начинаем!</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.5</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.6</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.7</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">Начинаем!</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.8</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge stages__item-badge_icon">
            <img
              class="stages__item-badge-icon"
              src="~/assets/icons/done-white.svg"
              alt=""
            /><span class="stages__item-badge-text"></span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
      </div>
      <div class="stages__grid stages__grid_desktop">
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.1</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">Начинаем!</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.2</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.3</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.4</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">Начинаем!</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.5</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.6</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.7</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">Начинаем!</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.8</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">0.9</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">1.0</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge">
            <span class="stages__item-badge-text">1.1</span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
        <div class="stages__item">
          <div class="stages__item-badge stages__item-badge_icon">
            <img
              class="stages__item-badge-icon"
              src="~/assets/icons/done-white.svg"
              alt=""
            /><span class="stages__item-badge-text"></span>
          </div>
          <div class="stages__item-info">
            <span class="stages__item-title">С нами удобно</span
            ><span class="stages__item-description"
              >Вы можете забрать готовый отчет об оценке лично или мы доставим
              курьером.</span
            >
          </div>
        </div>
      </div>
    </div>
  </section>
</template>

<script lang="ts">
import Swiper, { Scrollbar } from "swiper";

export class AdvantagesHandler {
  mainContainer: HTMLElement | null = null;
  stagesSlider: HTMLElement | null = null;

  constructor(element: HTMLElement) {
    this.mainContainer = element;

    this.stagesSlider = this.mainContainer.querySelector(".stages__slider");

    this.initStagesSlider();

    return this;
  }

  private initStagesSlider() {
    const swiper = new Swiper(this.stagesSlider as HTMLElement, {
      direction: "horizontal",
      slidesPerView: "auto",
      spaceBetween: 20,
      freeMode: true,

      modules: [Scrollbar],
      scrollbar: {
        el: ".swiper-scrollbar",
        dragSize: 65,
        hide: false,
      },
    });

    const afterElement = this.mainContainer?.querySelector(
      ".slider-after"
    ) as HTMLElement;

    swiper.on("sliderFirstMove", () => {
      afterElement.style.opacity = "0";
      afterElement.style.zIndex = "-1";
    });

    swiper.on("reachBeginning", () => {
      const afterElement = this.mainContainer?.querySelector(
        ".slider-after"
      ) as HTMLElement;

      afterElement.style.opacity = "1";
      afterElement.style.zIndex = "1";
    });

    return swiper;
  }
}

const initStages = () => {
  const stages = document.querySelectorAll(".stages");

  stages.forEach((element) => {
    new AdvantagesHandler(element as HTMLElement);
  });
};
if (process.browser) {
  window.addEventListener("load", initStages);
}

export default {
  name: "AppStages",
};
</script>

<style lang="scss" scoped>
@use "@/assets/scss/styles/utils" as ut;
@use "@/assets/scss/styles/variables" as vars;

.stages {
  display: flex;
  justify-content: center;
  padding: 2rem;

  width: 100%;

  @include ut.tablet {
    padding: 3rem 0 0 0;
  }

  @include ut.desktop {
    padding: 7.5rem 0 0 0;
  }

  &__container {
    display: flex;
    flex-direction: column;
    gap: 2rem;

    width: 320px;

    @include ut.tablet {
      width: 726px;
    }

    @include ut.desktop {
      gap: 7rem;
      width: 1201px;
    }
  }

  &__header {
    display: flex;

    @include ut.tablet {
      gap: 2.9rem;
    }

    @include ut.desktop {
      gap: 6.3rem;
    }

    &-appendix {
      display: none;

      @include ut.tablet {
        display: block;
        width: 40px;
        height: 5px;

        background-color: #c2d2df;

        margin-top: 16px;
      }
    }

    &-title {
      font-style: normal;
      font-weight: 700;
      font-size: 20px;
      line-height: 24px;

      color: #342633;

      @include ut.tablet {
        font-size: 24px;
        line-height: 29px;
      }

      @include ut.desktop {
        font-size: 28px;
        line-height: 34px;

        margin: -4px 0 0 0;
      }
    }
  }

  &__item {
    display: flex;
    gap: 20px;

    &-badge {
      display: flex;
      align-items: center;
      justify-content: center;

      width: 30px;
      height: 30px;

      background: #f3f3f3;
      border: 2px solid #ffb701;

      @include ut.desktop {
        width: 40px;
        height: 40px;
      }

      &_icon {
        border: none;
        background: #ffb701;
      }

      &-icon {
        width: 24px;
        height: 24px;
      }

      &-text {
        font-style: normal;
        font-weight: 250;

        font-size: 14px;
        line-height: 16px;

        display: flex;
        align-items: center;
        text-align: center;

        color: #342633;

        @include ut.desktop {
          font-size: 20px;
          line-height: 23px;
          display: flex;
          align-items: center;
          text-align: center;
        }
      }
    }

    &-info {
      display: flex;
      flex-direction: column;
      padding-top: 5px;
      gap: 6px;

      @include ut.desktop {
        padding-top: 8px;
        gap: 8px;
      }
    }

    &-title {
      font-weight: 700;
      font-size: 16px;
      line-height: 19px;

      display: flex;
      align-items: center;

      color: #342633;

      @include ut.desktop {
        font-size: 20px;
        line-height: 24px;

        display: flex;
        align-items: center;
      }
    }

    &-description {
      font-style: normal;
      font-weight: 500;
      font-size: 1.4rem;
      line-height: 2rem;
      word-break: break-all;

      color: #898088;

      width: 177px;

      @include ut.desktop {
        width: 210px;

        font-weight: 500;
        font-size: 16px;
        line-height: 23px;
      }
    }
  }

  &__slider {
    width: 100%;
    height: 136px;

    @include ut.tablet {
      display: none;
    }

    .swiper-slide {
      width: auto;
    }
    &::after {
      content: "";
      position: absolute;
      right: 0;
      top: 0;

      width: 70px;
      height: 110px;
      z-index: 2;

      pointer-events: none;
      background: linear-gradient(
        270deg,
        #ffffff 0%,
        rgba(255, 255, 255, 0.8) 52.6%,
        rgba(255, 255, 255, 0) 100%
      );
      transform: matrix(1, 0, 0, -1, 0, 0);
    }

    .swiper__scrollbar {
      width: 100%;
    }
  }

  &__grid {
    display: none;

    &_desktop {
      display: none;

      @include ut.desktop {
        display: flex;
        flex-wrap: wrap;

        column-gap: 38px;
        row-gap: 80px;
        padding: 35px 0 103px 0;

        background-image: url("@/assets/images/stages-desktop.png");
        background-repeat: no-repeat;
        background-position: 19px 12px;
      }
    }

    &_tablet {
      display: none;

      @include ut.tablet {
        display: flex;
        flex-wrap: wrap;
        column-gap: 20px;
        row-gap: 50px;
        padding: 32px 0 59px 0px;

        background-image: url("@/assets/images/stages-tablet.png");
        background-repeat: no-repeat;
        background-position: 13px 9px;
      }

      @include ut.desktop {
        display: none;
      }
    }
  }
}
</style>
